<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>آمار کاربران امروز</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
            direction: rtl;
        }
        .stats-container {
            background-color: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
            max-width: 400px;
            margin: 0 auto;
            text-align: right;
        }
        h2 {
            color: #333;
        }
        p {
            margin: 10px 0;
        }
        .loading {
            color: #666;
        }
        .error {
            color: red;
        }
    </style>
</head>
<body>
    <h1>آمار کاربران</h1>
    <div class="stats-container" id="stats">
        <h2>کاربران امروز</h2>
        <div id="daily-stats" class="loading">در حال بارگذاری...</div>
    </div>

    <script>
        // آدرس سرور واسطه
        const proxyUrl = "https://your-server.com/proxy.php"; // آدرس فایل PHP خود را وارد کنید

        // دریافت داده‌ها با fetch
        fetch(proxyUrl)
            .then(response => {
                if (!response.ok) {
                    throw new Error("خطا در دریافت داده‌ها: " + response.status);
                }
                return response.text();
            })
            .then(data => {
                const jsonLines = data.split('\n').filter(line => line.trim() !== '');
                let jsonData;
                jsonLines.forEach(line => {
                    if (line.includes('"type":"dump"')) {
                        jsonData = JSON.parse(line.replace('data: ', ''));
                    }
                });

                if (!jsonData || !jsonData.payload.sites["m4tinbeigi-official.github.io"]) {
                    throw new Error("داده‌های مورد انتظار یافت نشد.");
                }

                const siteData = jsonData.payload.sites["m4tinbeigi-official.github.io"];
                const totalVisits = siteData.count;
                const today = new Date().toISOString().split('T')[0]; // تاریخ امروز
                const todayVisits = siteData.visits.day.date[today] || 0;

                let htmlContent = `
                    <p>تعداد کاربران امروز: ${todayVisits}</p>
                    <p>تعداد کل بازدیدها (فعالیت کلی): ${totalVisits}</p>
                `;

                document.getElementById("daily-stats").innerHTML = htmlContent;
            })
            .catch(error => {
                document.getElementById("daily-stats").className = "error";
                document.getElementById("daily-stats").innerHTML = "خطا: " + error.message;
            });
    </script>
</body>
</html>